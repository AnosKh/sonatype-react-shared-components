/*
 * Copyright (c) 2019-present Sonatype, Inc.
 * This program and the accompanying materials are made available under
 * the terms of the Eclipse Public License 2.0 which accompanies this
 * distribution and is available at https://www.eclipse.org/legal/epl-2.0/.
 */
const { Region, Target } = require('@applitools/eyes-webdriverio');
const { simpleTest } = require('./testUtils');

describe('NxVulnerabilityDetails', function() {
  beforeEach(async function() {
    await browser.url('#/pages/NxVulnerabilityDetails');
  });

  const selector = '.gallery-example .nx-vulnerability-details';

  it('looks right', async function() {
    const targetElement = await browser.$(selector),
        screenshotHeight = 900,
        headerHeight = 75;

    const { x, y, width, height } = await browser.getElementRect(targetElement.elementId),
        topScreenshotRegion = new Region(x, y, width, screenshotHeight),
        bottomScreenshotRegion = new Region(x, y + screenshotHeight, width, height - screenshotHeight);

    // This element is too big to fit in the viewport at once, so we have to take a few screenshots amidst some
    // scrolling. Note that this scrolling has to take into account the page header which is about 75px tall
    await browser.execute(function(x, y) {
      return window.scroll(x, y);
    }, 0, y - headerHeight);

    await browser.eyesRegionSnapshot('Top Part', Target.region(topScreenshotRegion));

    await browser.execute(function(x, y) {
      return window.scroll(x, y);
    }, 0, y + screenshotHeight - headerHeight);

    await browser.eyesRegionSnapshot('Bottom Part', Target.region(bottomScreenshotRegion));
  });
});
