/*
 * Copyright (c) 2019-present Sonatype, Inc.
 * This program and the accompanying materials are made available under
 * the terms of the Eclipse Public License 2.0 which accompanies this
 * distribution and is available at https://www.eclipse.org/legal/epl-2.0/.
 */
import {getShallowComponent} from '../../../__testutils__/enzymeUtils';

import SeverityScoreDisplay, {Props} from '../details/SeverityScoreDisplay';

describe('SeverityScoreDisplay', function () {
  const simpleProps: Props = {
    severityScore: {
      source: 'cve_cvss_2',
      score: 7
    }
  };
  const getShallow = getShallowComponent<Props>(SeverityScoreDisplay, simpleProps);

  it('displays score with one fixed decimal', function () {
    expect(getShallow().find('dt')).toHaveText('CVE CVSS 2.0:');
    expect(getShallow().find('dd')).toHaveText('7.0');
  });

  it('renders cve_cvss_2 source and score', function () {
    const shallowRender = getShallow({
      severityScore: {
        source: 'cve_cvss_2',
        score: 7.5
      }
    });
    expect(shallowRender.find('dt')).toHaveText('CVE CVSS 2.0:');
    expect(shallowRender.find('dd')).toHaveText('7.5');
  });

  it('renders cve_cvss_3 source and score', function () {
    const shallowRender = getShallow({
      severityScore: {
        source: 'cve_cvss_3',
        score: 7.5
      }
    });
    expect(shallowRender.find('dt')).toHaveText('CVE CVSS 3:');
    expect(shallowRender.find('dd')).toHaveText('7.5');
  });

  it('renders sonatype_cvss_2 source and score', function () {
    const shallowRender = getShallow({
      severityScore: {
        source: 'sonatype_cvss_2',
        score: 7.5
      }
    });
    expect(shallowRender.find('dt')).toHaveText('Sonatype CVSS 2.0:');
    expect(shallowRender.find('dd')).toHaveText('7.5');
  });

  it('renders sonatype_cvss_3 source and score', function () {
    const shallowRender = getShallow({
      severityScore: {
        source: 'sonatype_cvss_3',
        score: 7.5
      }
    });
    expect(shallowRender.find('dt')).toHaveText('Sonatype CVSS 3:');
    expect(shallowRender.find('dd')).toHaveText('7.5');
  });

  it('renders only the numerical score when source is absent', function () {
    const shallowRender = getShallow({
      severityScore: {
        score: 3.1
      }
    });
    expect(shallowRender).toHaveText('3.1');
  });
});
